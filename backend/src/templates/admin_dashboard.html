<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Lab Timetable</title>
    <link rel="stylesheet" href="/static/css/admin_dashboard.css">
    <link rel="stylesheet" href="/static/css/toast.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="header">
        <div style="display:flex; flex-direction:column;">
            <h1>Admin Dashboard</h1>
            <span style="font-size:14px; opacity:0.9; font-weight:normal;">Welcome, {{ user.name }}</span>
        </div>
        <div style="margin-left:auto; display:flex; gap:10px;">
            {% if user.role == 'SUPER_ADMIN' %}
            <button onclick="openModal('pwd-modal')" class="btn-logout" style="background:#ff9800;">Change
                Password</button>
            {% endif %}
            <a href="/logout" class="btn-logout">Logout</a>
        </div>
    </div>

    <!-- Main Container for AJAX Swap -->
    <div class="container">
        <!-- TABS -->
        <div class="tab-container">
            <div id="btn-calendar" class="tab active" onclick="openTab('calendar')">Master Schedule</div>
            <div id="btn-manage" class="tab" onclick="openTab('manage')">Manage Bookings</div>
            <div id="btn-leaves" class="tab" onclick="openTab('leaves')">Leaves {% if pending_count > 0 %}<span
                    style="background:red; color:white; border-radius:50%; padding:2px 6px; font-size:12px;">{{
                    pending_count }}</span>{% endif %}</div>
            <div id="btn-instructors" class="tab" onclick="openTab('instructors')">Instructors</div>
            <div id="btn-resources" class="tab" onclick="openTab('resources')">Resources</div>
        </div>




        <!-- CALENDAR TAB -->
        <div id="calendar" class="tab-content active">
            <!-- AJAX Container -->
            <div id="calendar-container">
                {% include 'partials/calendar_grid.html' %}
            </div>
        </div>

        <!-- MANAGE BOOKINGS TAB -->
        <div id="manage" class="tab-content">
            <form action="/bookings/create" method="POST" class="create-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <h3>Create New Booking</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label>Module</label>
                        <select name="module_code" required>
                            <option value="">Select Module</option>
                            {% for m in active_modules %}
                            <option value="{{ m.code }}">{{ m.code }} - {{ m.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Lab</label>
                        <select name="lab_id" required>
                            <option value="">Select Lab</option>
                            {% for l in active_labs %}
                            {% if l.is_active %}
                            <option value="{{ l.id }}">{{ l.name }} (Cap: {{ l.capacity }})</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Instructor</label>
                        <select name="instructor_id" required>
                            <option value="">Select Instructor</option>
                            {% for i in active_instructors %}
                            <option value="{{ i.id }}">{{ i.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" name="booking_date" required>
                    </div>
                    <div class="form-group">
                        <label>Start Time</label>
                        <input type="time" name="start_time" required>
                    </div>
                    <div class="form-group">
                        <label>End Time</label>
                        <input type="time" name="end_time" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Purpose</label>
                        <select name="purpose">
                            <option value="CLASS">Class</option>
                            <option value="EXAM">Exam</option>
                            <option value="ADHOC">Ad-Hoc / Maintenance</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Practical Name (Optional)</label>
                        <input type="text" name="practical_name" placeholder="e.g. Lab 01">
                    </div>
                </div>

                <!-- Enhanced Recurring Checkbox -->
                <div class="recurring-section">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="is_recurring" name="is_recurring" onchange="toggleRecurring()">
                        <label for="is_recurring">Repeat Weekly?</label>
                    </div>

                    <div id="recurring_end_div">
                        <label>Repeat Until:</label>
                        <input type="date" id="repeat_until" name="repeat_until">
                    </div>
                </div>

                <button type="submit" class="btn-primary">Create Booking</button>
            </form>

            <!-- BOOKING LIST -->
            <h3>All Bookings</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Module</th>
                        <th>Lab</th>
                        <th>Instructor</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for b in bookings %}
                    <tr>
                        <td>{{ b.booking_date }}</td>
                        <td>{{ b.start_time }} - {{ b.end_time }}</td>
                        <td>{{ b.module_code }}</td>
                        <td>{{ b.lab.name }}</td>
                        <td>{{ b.instructor.name }}</td>
                        <td>
                            <button class="btn-edit" data-id="{{ b.id }}" data-date="{{ b.booking_date }}"
                                data-start="{{ b.start_time }}" data-end="{{ b.end_time }}"
                                data-module="{{ b.module_code }}" data-lab="{{ b.lab_id }}"
                                data-instructor="{{ b.booked_by_id }}" data-practical="{{ b.practical_name }}"
                                data-purpose="{{ b.purpose }}" onclick="openEditBookingModal(this)"
                                style="background:none; border:none; color:#1976d2; cursor:pointer; font-weight:bold; margin-right:5px;">
                                Edit
                            </button>
                            <form action="/bookings/delete/{{ b.id }}" method="POST"
                                onsubmit="return confirm('Delete booking?');" style="display:inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                <button class="btn-delete">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div id="leaves" class="tab-content">
            <!-- New Admin Leave Form -->
            <div class="card"
                style="margin-bottom: 20px; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top:0;">Place Leave (Admin Override)</h3>
                <form action="/leaves/request" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Instructor</label>
                            <select name="target_instructor_id" required>
                                <option value="">-- Select Instructor --</option>
                                <option value="{{ user.id }}">Myself ({{ user.name }})</option>
                                {% for i in all_instructors %}
                                {% if i.id != user.id %}
                                <option value="{{ i.id }}">{{ i.name }} ({{ i.department_code }})</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" name="start_date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="display: flex; align-items: center; padding-top: 25px;">
                            <input type="checkbox" id="admin_leave_multi_day" onchange="toggleAdminLeaveEnd()"
                                style="width: auto; margin-right: 10px;">
                            <label for="admin_leave_multi_day" style="margin-bottom: 0; cursor:pointer;">Multi-day
                                Leave?</label>
                        </div>
                        <div class="form-group" id="admin_leave_end_div" style="display: none;">
                            <label>End Date</label>
                            <input type="date" name="end_date" id="admin_leave_end_date">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Reason</label>
                        <input type="text" name="reason" placeholder="Medical, Personal, etc." required>
                    </div>
                    <button type="submit" class="btn-primary" style="width: auto; margin-top: 20px;">Place
                        Leave</button>
                </form>
            </div>

            <h3>Pending Leave Requests</h3>
            {% if pending_leaves %}
            <table>
                <thead>
                    <tr>
                        <th>Instructor</th>
                        <th>Period</th>
                        <th>Reason</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for leave in pending_leaves %}
                    <tr>
                        <td>{{ leave.instructor.name }}</td>
                        <td>{{ leave.start_date }} to {{ leave.end_date }}</td>
                        <td>{{ leave.reason }}</td>
                        <td class="action-cell">
                            <form action="/leaves/{{ leave.id }}/approve" method="POST" style="margin-right:10px;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                <button class="btn-toggle"
                                    style="background:#c8e6c9; color:#2e7d32; border-color:#a5d6a7;">Approve</button>
                            </form>
                            <form action="/leaves/{{ leave.id }}/reject" method="POST">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                <button class="btn-toggle"
                                    style="background:#ffcdd2; color:#c62828; border-color:#ef9a9a;">Reject</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="success">No pending leave requests.</p>
            {% endif %}

            <h3 style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">Processed Leave History</h3>
            {% if processed_leaves %}
            <table>
                <thead>
                    <tr>
                        <th>Instructor</th>
                        <th>Period</th>
                        <th>Reason</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for leave in processed_leaves %}
                    <tr>
                        <td>{{ leave.instructor.name }}</td>
                        <td>{{ leave.start_date }} to {{ leave.end_date }}</td>
                        <td>{{ leave.reason }}</td>
                        <td>
                            <span
                                class="status-tag {% if leave.status == 'APPROVED' %}approved{% elif leave.status == 'REJECTED' %}rejected{% else %}pending{% endif %}">
                                {{ leave.status }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="color:#888; text-align:center;">No history available.</p>
            {% endif %}
        </div>

        <!-- INSTRUCTORS TAB -->
        <div id="instructors" class="tab-content">
            <form action="/instructors/create" method="POST" class="create-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div class="form-row">
                    <div class="form-group"><label>Name</label><input type="text" name="name" required></div>
                    <div class="form-group"><label>Email</label><input type="email" name="email" required></div>
                    <div class="form-group">
                        <label>Dept</label>
                        <select name="dept">
                            {% for d in departments %}
                            <option value="{{ d.code }}">{{ d.code }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select name="role">
                            <option value="INSTRUCTOR" selected>INSTRUCTOR</option>
                            <option value="ADMIN">ADMIN</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>University</label><input type="text" name="university"></div>
                    <div class="form-group"><label>Degree</label><input type="text" name="degree"></div>
                    <div class="form-group"><label>Graduated</label><input type="date" name="graduated_date"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Photo URL</label><input type="text" name="photo_url"></div>
                </div>
                <button type="submit" class="btn-primary">Add Instructor</button>
            </form>

            <div class="grid-container">
                {% for i in all_instructors %}
                <div class="instructor-card {{ 'status-inactive' if not i.is_active else '' }}">
                    <img src="{{ i.photo_url if i.photo_url else 'https://ui-avatars.com/api/?name=' + i.name + '&background=004d40&color=fff' }}"
                        class="instructor-img" alt="{{ i.name }}">
                    <div class="instructor-name">{{ i.name }}</div>
                    <div class="instructor-meta">{{ i.department_code }} | {{ i.role }}</div>
                    <div class="instructor-details">
                        {{ i.email }}<br>
                        {% if i.university %}{{ i.university }}{% endif %}
                        {% if i.degree %}<br>{{ i.degree }}{% endif %}
                    </div>
                    <div class="card-actions">
                        <form action="/instructors/toggle/{{ i.id }}" method="POST" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button class="btn-toggle">{{ 'Disable' if i.is_active else 'Enable' }}</button>
                        </form>

                        {% if user.role == 'SUPER_ADMIN' or (user.role == 'ADMIN' and i.role == 'INSTRUCTOR') %}
                        <form action="/auth/reset-password/{{ i.id }}" method="POST" style="display:inline;"
                            onsubmit="return confirm('Reset password to default (password123)?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button class="btn-toggle"
                                style="background:#ffecb3; border-color:#e6c200; color:#8d7800;">Reset Pwd</button>
                        </form>
                        {% endif %}

                        <button class="btn-edit" data-id="{{ i.id }}" data-name="{{ i.name }}"
                            data-email="{{ i.email }}" data-dept="{{ i.department_code }}" data-role="{{ i.role }}"
                            data-univ="{{ i.university or '' }}" data-degree="{{ i.degree or '' }}"
                            data-grad="{{ i.graduated_date or '' }}" data-photo="{{ i.photo_url or '' }}"
                            onclick="openEditInstructorModal(this)"
                            style="background:none; border:none; color:#1976d2; cursor:pointer; font-weight:bold; margin-right:5px;">
                            Edit
                        </button>
                        <form action="/instructors/delete/{{ i.id }}" method="POST" style="display:inline;"
                            onsubmit="return confirm('Delete?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button class="btn-delete">Del</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>


        <!-- RESOURCES TAB -->
        <div id="resources" class="tab-content">
            <h3>Manage Labs</h3>
            <form action="/labs/create" method="POST" class="create-form" style="margin-bottom:30px;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div class="form-row">
                    <div class="form-group"><label>Lab Name</label><input type="text" name="name" required></div>
                    <div class="form-group"><label>Capacity</label><input type="number" name="capacity" required></div>
                    <div class="form-group">
                        <label>Dept</label>
                        <select name="dept">
                            {% for d in departments %}
                            <option value="{{ d.code }}">{{ d.code }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group"><label>Location</label><input type="text" name="location"></div>
                </div>
                <button type="submit" class="btn-primary" style="width:auto;">Add Lab</button>
            </form>

            <div class="grid-container">
                {% for l in all_labs %}
                <div class="instructor-card {{ 'status-inactive' if not l.is_active else '' }}"
                    style="align-items:flex-start; text-align:left;">
                    <div class="instructor-name">{{ l.name }}</div>
                    <div class="instructor-meta">Capacity: {{ l.capacity }}</div>
                    <div class="instructor-details">
                        {{ l.location if l.location else 'No location set' }}
                    </div>
                    <div class="card-actions" style="justify-content:flex-start;">
                        <!-- Edit Button -->
                        <button class="btn-edit" data-id="{{ l.id }}" data-name="{{ l.name }}"
                            data-capacity="{{ l.capacity }}" data-location="{{ l.location or '' }}"
                            data-dept="{{ l.department_code }}" onclick="openEditLabModal(this)"
                            style="background:none; border:none; color:#1976d2; cursor:pointer; font-weight:bold; margin-right:5px;">
                            Edit
                        </button>

                        <form action="/labs/toggle/{{ l.id }}" method="POST" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button class="btn-toggle">{{ 'Disable' if l.is_active else 'Enable' }}</button>
                        </form>
                        <form action="/labs/delete/{{ l.id }}" method="POST" style="display:inline;"
                            onsubmit="return confirm('Delete?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button class="btn-delete">Del</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>

            <h3 style="margin-top:40px;">Manage Modules</h3>
            <form action="/modules/create" method="POST" class="create-form" style="margin-bottom:30px;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div class="form-row">
                    <div class="form-group"><label>Code</label><input type="text" name="code" required></div>
                    <div class="form-group"><label>Title</label><input type="text" name="title" required></div>
                    <div class="form-group">
                        <label>Dept</label>
                        <select name="dept">
                            {% for d in departments %}
                            <option value="{{ d.code }}">{{ d.code }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Semester</label>
                        <select name="semester">
                            <option value="1">Sem 1</option>
                            <option value="2">Sem 2</option>
                            <option value="3">Sem 3</option>
                            <option value="4">Sem 4</option>
                            <option value="5">Sem 5</option>
                            <option value="6">Sem 6</option>
                            <option value="7">Sem 7</option>
                            <option value="8">Sem 8</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn-primary" style="width:auto;">Add Module</button>
            </form>

            <table>
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Dept</th>
                        <th>Sem</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in all_modules %}
                    <tr class="{{ 'status-inactive' if not m.is_active else '' }}">
                        <td>{{ m.code }}</td>
                        <td>{{ m.title }}</td>
                        <td>{{ m.offering_dept }}</td>
                        <td>{{ m.semester }}</td>
                        <td>
                            <!-- Edit Button -->
                            <button class="btn-edit" data-code="{{ m.code }}" data-title="{{ m.title }}"
                                data-sem="{{ m.semester }}" data-dept="{{ m.offering_dept }}"
                                onclick="openEditModuleModal(this)"
                                style="background:none; border:none; color:#1976d2; cursor:pointer; font-weight:bold; margin-right:5px;">
                                Edit
                            </button>

                            <form action="/modules/toggle/{{ m.id }}" method="POST" style="display:inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                <button class="btn-toggle">{{ 'Disable' if m.is_active else 'Enable' }}</button>
                            </form>
                            <form action="/modules/delete/{{ m.code }}" method="POST" style="display:inline;"
                                onsubmit="return confirm('Delete?');">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                <button class="btn-delete">Del</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>

        <!-- Password Change Modal -->
        <div id="pwd-modal" class="modal-overlay">
            <div class="modal-content">
                <h3 style="margin-top:0;">Change Password</h3>
                <span onclick="closeModal('pwd-modal')" class="modal-close">✕</span>
                <form action="/auth/change-password" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <div class="form-group">
                        <label>Current Password</label>
                        <input type="password" name="old_password" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" name="new_password" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" name="confirm_password" required class="form-control">
                    </div>
                    <button type="submit" class="btn-primary" style="width:100%;">Update Password</button>
                </form>
            </div>
        </div>

        <!-- EDIT LAB MODAL -->
        <div id="edit-lab-modal" class="modal-overlay">
            <div class="modal-content">
                <h3 style="margin-top:0;">Edit Lab</h3>
                <span onclick="closeModal('edit-lab-modal')" class="modal-close">✕</span>
                <form id="edit-lab-form" action="" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <div class="form-group">
                        <label>Lab Name</label>
                        <input type="text" id="edit_lab_name" name="name" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Capacity</label>
                        <input type="number" id="edit_lab_capacity" name="capacity" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Department</label>
                        <select id="edit_lab_dept" name="dept">
                            {% for d in departments %}
                            <option value="{{ d.code }}">{{ d.code }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="edit_lab_location" name="location" class="form-control">
                    </div>
                    <button type="submit" class="btn-primary" style="width:100%; margin-top: 20px;">Update Lab</button>
                </form>
            </div>
        </div>

        <!-- EDIT MODULE MODAL -->
        <div id="edit-module-modal" class="modal-overlay">
            <div class="modal-content">
                <h3 style="margin-top:0;">Edit Module</h3>
                <span onclick="closeModal('edit-module-modal')" class="modal-close">✕</span>
                <form id="edit-module-form" action="" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <div class="form-group">
                        <label>Code</label>
                        <input type="text" id="edit_mod_code" name="new_code" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="edit_mod_title" name="title" required class="form-control">
                    </div>
                    <!-- Note: 'code' is primary key but we might want to allow editing, 
                     usually primary keys are locked. Let's assume code is locked for now to keep it simple -->
                    <div class="form-group">
                        <label>Department</label>
                        <select id="edit_mod_dept" name="dept">
                            {% for d in departments %}
                            <option value="{{ d.code }}">{{ d.code }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Semester</label>
                        <select id="edit_mod_sem" name="semester">
                            <option value="1">Sem 1</option>
                            <option value="2">Sem 2</option>
                            <option value="3">Sem 3</option>
                            <option value="4">Sem 4</option>
                            <option value="5">Sem 5</option>
                            <option value="6">Sem 6</option>
                            <option value="7">Sem 7</option>
                            <option value="8">Sem 8</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary" style="width:100%; margin-top: 20px;">Update
                        Module</button>
                </form>
            </div>
        </div>

        <!-- EDIT BOOKING MODAL -->
        <div id="edit-booking-modal" class="modal-overlay">
            <div class="modal-content">
                <h3 style="margin-top:0;">Edit Booking</h3>
                <span onclick="closeModal('edit-booking-modal')" class="modal-close">✕</span>
                <form id="edit-booking-form" action="" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="edit_bk_date" name="booking_date" required class="form-control">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Start</label>
                            <input type="time" id="edit_bk_start" name="start_time" required class="form-control">
                        </div>
                        <div class="form-group">
                            <label>End</label>
                            <input type="time" id="edit_bk_end" name="end_time" required class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Module</label>
                        <select id="edit_bk_module" name="module_code" required>
                            {% for m in all_modules %}
                            <option value="{{ m.code }}">{{ m.code }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Lab</label>
                        <select id="edit_bk_lab" name="lab_id" required>
                            {% for l in all_labs %}
                            <option value="{{ l.id }}">{{ l.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Instructor</label>
                        <select id="edit_bk_instructor" name="instructor_id" required>
                            {% for i in all_instructors %}
                            <option value="{{ i.id }}">{{ i.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Practical (Opt)</label>
                        <input type="text" id="edit_bk_practical" name="practical_name" class="form-control">
                    </div>

                    <button type="submit" class="btn-primary" style="width:100%; margin-top:20px;">Save Changes</button>
                </form>
            </div>
        </div>

        <!-- EDIT INSTRUCTOR MODAL -->
        <div id="edit-instructor-modal" class="modal-overlay">
            <div class="modal-content">
                <h3 style="margin-top:0;">Edit Instructor</h3>
                <span onclick="closeModal('edit-instructor-modal')" class="modal-close">✕</span>
                <form id="edit-instructor-form" action="" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <div class="form-row">
                        <div class="form-group"><label>Name</label><input type="text" id="edit_inst_name" name="name"
                                required class="form-control"></div>
                        <div class="form-group"><label>Email</label><input type="email" id="edit_inst_email"
                                name="email" required class="form-control"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Dept</label>
                            <select id="edit_inst_dept" name="dept">
                                {% for d in departments %}
                                <option value="{{ d.code }}">{{ d.code }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="edit_inst_role" name="role">
                                <option value="INSTRUCTOR">INSTRUCTOR</option>
                                <option value="ADMIN">ADMIN</option>
                            </select>
                        </div>
                    </div>
                    <!-- Extended Details -->
                    <div class="form-row">
                        <div class="form-group"><label>University</label><input type="text" id="edit_inst_univ"
                                name="university" class="form-control"></div>
                        <div class="form-group"><label>Degree</label><input type="text" id="edit_inst_degree"
                                name="degree" class="form-control"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Graduated</label><input type="date" id="edit_inst_grad"
                                name="graduated_date" class="form-control"></div>
                        <div class="form-group"><label>Photo URL</label><input type="text" id="edit_inst_photo"
                                name="photo_url" class="form-control"></div>
                    </div>

                    <button type="submit" class="btn-primary" style="width:100%;">Update Instructor</button>
                </form>
            </div>
        </div>


    </div>

    <script src="/static/js/admin_dashboard.js"></script>
    <script src="/static/js/toast.js"></script>
    <script src="/static/js/ajax_handler.js"></script>
</body>

</html>